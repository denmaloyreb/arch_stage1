# 1.7 Практическая работа

## Задача 1. REST vs Messaging

>**Что нужно сделать**
>
>Вы проектируете систему интернет-магазина, в котором есть два приложения, Order Service и Delivery Service:
>
>Order Service отвечает за принятие заказов у клиента;
>Delivery Service рассчитывает дату доставки товара в зависимости от загрузки курьерской службы.
>Текущая архитектура отражена на диаграмме:
>
>![Схема взаимодействия Order Service и Delivery Service](img/ex1.png)
>
>1. Продумайте интеграцию между Order Service и Delivery Service. Сравните два подхода к интеграции — REST, синхронный подход к интеграции, и Messaging, при котором запросы отправляются асинхронно.
>
>2. Ответьте на вопросы:
>
>    * Какие плюсы и минусы у REST?
>    * Какие плюсы и минусы у Messaging?
>    * Какие факторы должны учитываться при принятии решения? *(необязательный вопрос, ответьте по желанию).

### Решение задачи

#### REST (синхронный подход к интеграции)

| Плюсы | Минусы |
|------------------------|-----------------------|
|*Простота реализации и поддержки.* <br> Нужно обслуживать меньше компонентов. Если нужно изменить логику обработки информации, это делается только на сервере. Вносить изменения для клиента не придется.|*Таймауты.* <br> Запросы обрабатываются синхронно: пока текущий обрабатывается, следующий "ждет". При большом количестве запросов могут возникать большие задержки. Также если с API сервера будет взаимодействовать много клиентов, возможны такие же проблемы.|
|*Запрос обрабатывается единожды*. Повторная обработка и возникновение дублей не происходят.|*Относительно небольшая отказоустойчивость. Сервер — единая точка отказа.* <br> Для повышения надежности системы нужно создавать дополнительные инстансы.|
||*Нет гарантий обработки запроса.* <br> Если сервер перестанет отвечать или возникнет таймаут, запрос может "потеряться"|

<!-- |*Совместимость практически с любыми платформами и языками программирования.* <br> Order Service и Delivery Service можно разрабатывать на разных ЯП, и они будут прекрасно взаимодействовать друг с другом.|*Таймауты.* <br> Запросы обрабатываются синхронно: пока текущий обрабатывается, следующий "ждет". При большом количестве запросов могут возникать большие задержки. Также если с API сервера будет взаимодействовать много клиентов, возможны такие же проблемы.|
|*"Дружит" с HTTP* <br> Стиль разрабатывался с прицелом на HTTP, и хорошо подходит при для работы с этим протоколом.|*Передача избыточной информации (в т.ч. из-за HATEOAS).* <br> В ответе на запрос может приходить "лишняя" информация (например, запрашивается номер телефона по ID клиента, а в ответ приходит еще адрес, статус и т.д.). Отсюда возможно влияние на скорость взаимодействия.|
|*Простота поддержки.* <br> Если нужно изменить логику обработки информации, это делается только на сервере. Вносить изменения для клиента не придется.|*Сервер — единая точка отказа.* <br> Для повышения надежности системы нужно создавать дополнительные инстансы.|
|*Хранение состояний и информации о сессиях с клиентом не предполагается.* <br> Положительно влияет на скорость обработки запросов. Можно использовать кэширование.|*Рост нагрузки на сеть при "росте" системы.* <br> Обусловлено, в частности HATEOAS и Stateless — каждый раз передается "много" информации|
|*Возможность реализации слоистой архитектуры.* <br> Между Order Service и Delivery Service можно размещать балансировщики, прокси и других "посредников", при этом изменение архитектуры системы не отразится на логике работы этих элементов|| -->

#### Messaging (запросы отправляются асинхронно)

| Плюсы | Минусы |
|------------------------|-----------------------|
|*Асинхронность и уменьшение вероятности возникновения таймаутов.* <br> Чтобы обработать запрос, не нужно ждать, пока выполнится предыдущий, из-за этого таймауты менее вероятны.|*Усложнение системы.* <br> Появляются новые элементы (в частности, брокеры сообщений), которые нужно поддерживать и обслуживать.|
|*Повышение отказоустойчивости.* <br> Нет единой точки отказа.|*Вероятность повторной обработки запроса.* <br> Пораждается гарантией доставки сообщения. Нужно предусмотреть механизм устранение дублей.|
|*Можно говорить о гарантированной обработке запроса (в случае с At least once).* <br> Если сервер или клиент будет какое-то время недоступным, сообщение сохранится и дойдет до адресата, как только он снова стане доступен.||

<!-- |*Асинхронность.* <br> Чтобы обработать запрос, не нужно ждать, пока выполнится предыдущий.|*Усложнение системы.* <br> Появляются новые элементы (в частности, брокеры сообщений), которые нужно поддерживать и обслуживать.|
|*Повышение отказоустойчивости.* <br> Нет единой точки отказа.|*Вероятность повторной обработки запроса.* <br>  Поражается гарантией доставки сообщения. Нужно предусмотреть механизм устранение дублей.|
|*Можно говорить о гарантированной обработке запроса (в случае с At least once).* <br> Если сервер или клиент будет какое-то время недоступным, сообщение сохранится и дойдет до адресата, как только он снова стане доступен.||
|*Гибкость системы, масштабируемость.* <br> Связь между приложениями и их зависимость друг от друга ослабляется.|| -->
#### Какие факторы должны учитываться при принятии решения

1. Масштаб системы. 
2. Монолит или микросервисная архитектура.
3. Количество курьерских служб, с которыми взаимодействует Delivery Service.
4. По каким протоколам будет происходить взаимодействие  Order Service и Delivery Service.
5. Нужно отображать дату доставки в режиме онлайн, перед оформлением заказа или рассчитывать ее позже и отправлять клиенту вместе с подтверждением заказа.


## Задача 2. Database

>**Что нужно сделать**
>
>Вы определились с интеграцией между сервисами. Теперь вам нужно решить, как будут храниться данные.
>
>1. Выберите один из способов хранения данных:
>
>    * общую базу данных (БД) для этих сервисов:
>    ![Общая БД](img/ex2.png)
>    * отдельные базы данных для каждого сервиса:
>    ![Отдельные БД для Order Service и Delivery Service](img/ex3.png)
>
>2. Проанализируйте компромиссы в предложенных решениях, оцените преимущества и недостатки каждого подхода и ответьте на вопросы:
>
>    1. Какие плюсы и минусы у общей БД?
>    2. Какие плюсы и минусы у раздельных БД?
>    3. Какие факторы должны учитываться при принятии решения? *(необязательный вопрос, ответьте по желанию)

### Решение задачи

#### Общая БД

| Плюсы | Минусы |
|------------------------|-----------------------|
|*Легкость администрирования (условная, конечно же).* <br> Все данные хранятся в одном месте.|*Единая точка отказа.* <br> Ляжет общая БД — лягут все завязанные на нее потребители.|*Единая точка отказа.* <br> Ляжет общая БД — лягут все завязанные на нее потребители.|
|*Требуется меньше ресурсов.* <br> Условно один физический сервер или виртуальная машина.|*Относительно невысокая скорость.* <br> Чем больше клиентов обращается к единой БД, тем ниже скорость обработки запросов.|
|*Легче избежать дублирования данных.* <br> В централизованной БД это легче отслеживать.||

<!-- |*Легкость администрирования (условная, конечно же).* <br> Все данные хранятся в одном месте.|*Единая точка отказа.* <br> Ляжет общая БД — лягут все завязанные на нее потребители.|
|*Требуется меньше ресурсов.* <br> Условно один физический сервер или виртуальная машина.|*Замедление работы.* <br> Чем больше сервисов будет обращаться к БД, тем медленнее она будет работать. Придется думать над балансировщиками или in memory БД.|
|*Легче избежать дублирования данных.* <br> В централизованной БД это легче отслеживать|*"Неуниверсальность"*. <br> Одна БД может идеально подходить для одного сервиса, и не очень — для другого.| -->

### Отдельные БД

| Плюсы | Минусы |
|------------------------|-----------------------|
|*Нет единой точки отказа.* <br> БД одного сервиса не влияет на работу других|*Более сложная реализация и администрирование.* <br> Чем сложнее система, тем сложнее ее поддерживать и обслуживать|
|*Скорость работы.* <br> Запросы к разным БД обрабатываются быстрее, чем к одной.|*Ресурсы.* <br> На раздельные БД их требуется больше, чем на общую.|
||*Увеличивается вероятность появления дублей.* <br> Придется продумывать механизмы защиты от дублирования.|

<!-- |*Нет единой точки отказа.* <br> БД одного сервиса не влияет на работу других|*Возможные проблемы с синхронизацией данных.* <br> Нужно продумать механизм синхронизации.|
|*Адаптация под нужды конкретного сервиса.* <br> Например, одному сервису лучше подходит реляционная БД, второму — другой тип БД. Не придется пытаться совместить в одном месте несовместимые (ну или почти) вещи.|*Увеличивается вероятность появления дублей.* <br> Придется продумывать механизмы защиты от дублирования.|
||*Ресурсы.* <br> На раздельные БД их требуется больше, чем на общую.| -->

#### Какие факторы должны учитываться при принятии решения

1. Ресурсы.
2. Критичность возникновения дублей информации.
3. Требования по быстродействию.
4. Пожелания по отказоустойчивости.
